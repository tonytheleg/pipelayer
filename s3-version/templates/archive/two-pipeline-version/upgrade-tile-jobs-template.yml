- name: upgrade-TILE_NAME-tile
  plan:
  - aggregate:
    - get: TILE_NAME-tile
      tags: [backups]
      trigger: true
    - get: pcf-tile-configurator
      tags: [backups]
    - get: platform-automation-image
      tags: [backups]
      params:
        unpack: true
    - get: platform-automation-tasks
      tags: [backups]
      params:
        unpack: true
# NON-REPLICATED-TILE+++
  - task: upload-and-stage-product
    tags: [backups]
    image: platform-automation-image
    file: platform-automation-tasks/tasks/upload-and-stage-product.yml
    input_mapping:
      product: TILE_NAME-tile
      env: pcf-tile-configurator
    params:
      ENV_FILE: envs/INSERT_FOUNDATION_HERE
# NON-REPLICATED-TILE---
# REPLICATED-TILE+++
  - task: upload-stage-and-replicate-product
    tags: [backups]
    image: platform-automation-image
    file: pcf-tile-configurator/pcf-automation/s3-version/extra-tasks/upload-stage-and-replicate-product.yml
    input_mapping:
      product: TILE_NAME-tile
      env: pcf-tile-configurator
      config: pcf-tile-configurator
    params:
      ENV_FILE: envs/INSERT_FOUNDATION_HERE
      CONFIG_FILE: automation-configs/INSERT_PRODUCT_HERE
# REPLICATED-TILE---
  - task: configure-product
    tags: [backups]
    image: platform-automation-image
    file: platform-automation-tasks/tasks/configure-product.yml
    input_mapping:
      config: pcf-tile-configurator
      env: pcf-tile-configurator
      vars: pcf-tile-configurator
    params:
      CONFIG_FILE: products/INSERT_PRODUCT_HERE
      ENV_FILE: envs/INSERT_FOUNDATION_HERE
      VARS_FILES: vars/envs/INSERT_FOUNDATION_HERE

